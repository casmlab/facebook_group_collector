<!DOCTYPE html>
<html>
<head>
  <title>Fetch Group</title>
  <meta charset="utf-8">
  <meta keywords="facebook group collector">
</head>
<body>
  <p>Hello, world!</p>
  <script>
  // setup javascript sdk
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1065187026859191',
      xfbml      : true,
      version    : 'v2.6'
    });
//     FB.getLoginStatus(function(response) {
//   if (response.status === 'connected') {
//     console.log('Logged in.');
//   }
//   else {
//     FB.login();
//   }
// });
  };
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
  // end setup javascript sdk
  </script>
  <script>
  // var pageCount = 1;
  var groupID;

  function getID(link) {
  	// extract the name of the group
  	var link = "https://www.facebook.com/groups/asianamericanchicagonetwork/";
  	var regroup = /https:\/\/www.facebook.com\/groups\/(.*?)\//;
  	// var regroup = new RegExp("https:\/\/www.facebook.com\/groups\/(.*?)\/");
  	var repage = /https:\/\/www.facebook.com\/(.*?)\//;
  	var name;
  	var url;

  	// if name is a group name, use this
  	// search?q=asianamericanchicagonetwork&type=group
  	// if name is a page name, use name
  	// to grab group id
  	if (link.match(regroup)) {
  		name = link.match(regroup)[1];
        url = "search?q=" + name + "&type=group"
  	} else if (link.match(repage)) {
  		name = link.match(repage)[1];
  		url = name
  	} else {
  		console.log("Wrong link");
  		return;
  	}



	FB.getLoginStatus(function(response) {
		if (response.status === 'connected') {
		  // the user is logged in and has authemticated your app
		  console.log("connected");
		  // var uid = response.authResponse.userID;
		  var accessToken = response.authResponse.accessToken;
		  console.log(url)
		  grab(url, accessToken);
		  // nextPage();
		} else {
		    console.log("not logged in");
		    FB.login();
		    // the user isn't logged in to Facebook
		  };
	});
  }

  function grab(url, accessToken) {
  	FB.api(
  		url,
  		{access_token : accessToken},
  		function (response) {
	        console.log("get response");
	        // console.log(response);
	        
	        // transfer response object to string, and save as json txt file.
	        if (response && !response.error) {
	          // console.log(response);
	          var t = JSON.stringify(response);
	          console.log(t);

	          groupID = response["data"][0]["id"];
	          console.log(groupID);
	          // saveFile(t);
	        } else {
	          console.log("some error!");
	        }
		}
	)
  }
  </script>
  // <script>
  // var groupID = "160475740743826";
  // var pageCount = 1;
  // function readData() {
  //     FB.getLoginStatus(function(response) {
  //       if (response.status === 'connected') {
  //         // the user is logged in and has authemticated your app
  //         console.log("connected");
  //         // var uid = response.authResponse.userID;
  //         var accessToken = response.authResponse.accessToken;
  //         var url = groupID + "/feed?fields=caption,created_time,description,from,id,link,message,message_tags,name,story,type,updated_time,comments{comments{object,parent,message,from,id,created_time},from,id,message,created_time,object},likes{id,name}";
  //         grabData(url, accessToken);
  //         // nextPage();
  //       } else {
  //           console.log("not logged in");
  //           FB.login();
  //           // the user isn't logged in to Facebook
  //         };
  //     });
  // }
  // function grabData(url, accessToken) {
  //   FB.api(
  //     url,
  //     {fields: 'posts'},
  //     {access_token : accessToken},
  //     function (response) {
  //       console.log("get response");
  //       // console.log(response);
        
  //       // transfer response object to string, and save as json txt file.
  //       if (response && !response.error) {
  //         // console.log(response);
  //         var t = JSON.stringify(response);
  //         console.log(t);
  //         saveFile(t);
  //       } else {
  //         console.log("some error!");
  //       }
  //       // set request interval to meet the limit of Facebook.
  //       setTimeout(function() {
  //           // if next page exists, go to next page and grab the data
  //           try {
  //             console.log(pageCount);
  //             nextPage = response["paging"]["next"];
  //             console.log("nextPage exists! try grab next page");
  //             // var nextPage = response["paging"]["next"];
  //             grabData(nextPage, accessToken);
              
  //             pageCount += 1;   
  //           }
  //           catch(e) {
  //             console.log("till the end of pages!");
  //             console.log(pageCount);
  //           };
  //       }, 10000);
        
  //     }
  //   );
  // }
  // function saveFile(data) {
  //   var url = 'data:text/json;charset=utf8,' + encodeURIComponent(data);
  //   window.open(url, '_blank');
  //   window.focus();
  // }  // var sur-fix = "?fields=";
  // // var query = "posts{message,comments{message,comments}}";
  // // var id =
  
  // </script>
  // <button onclick="readData()">Read Data on console and download</button>
  <button onclick="getID()">Get id</button>

</body>
<footer>
</footer>
</html>